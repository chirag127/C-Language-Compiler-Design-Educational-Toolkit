name: C Language CI/CD

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  build-test-lint:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Install C/C++ Toolchain and Linters
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential clang clang-format cppcheck
        pip install cpplint # Cpplint is a Python script, commonly used for C/C++

    - name: Compile Project
      run: make # Assumes a Makefile is present to build the project

    # For an educational toolkit, tests might involve running the compiled components
    # against predefined input files and verifying output, or executing specific test binaries.
    - name: Run Sample Verification/Tests (Placeholder)
      run: |
        echo "Running basic compilation verification for educational toolkit."
        # Add actual test commands here if the project includes automated tests.
        # Example: ./path/to/your_compiler --test-case-dir=./test_inputs
        # Example: make test # If your Makefile includes a 'test' target

    - name: Run CppLint Static Analysis
      run: |
        find . -name "*.c" -o -name "*.h" | xargs cpplint.py --filter=-build/include_subdir,-readability/casting

    - name: Check Code Formatting with ClangFormat
      run: |
        find . -name "*.c" -o -name "*.h" -print0 | xargs -0 clang-format --dry-run --Werror --style=Google
